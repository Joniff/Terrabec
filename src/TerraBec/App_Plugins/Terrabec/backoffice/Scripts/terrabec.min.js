angular.module("umbraco").controller("terrabec.connector",["$scope","$route","$routeParams","$q","$timeout","navigationService","localizationService","terrabecService",function(n,t,i,r,u,f,e,o){var s=this;angular.extend(s,{data:{},loading:!0,nodeId:i.id,overview:null,info:null,refreshButtonText:"",init:function(){r.all({overview:o.connector(s.nodeId),info:o.connectorInfo(s.nodeId),translateRefresh:e.localize("TerrabecInfo_RefreshButton")}).then(function(n){s.overview=n.overview;s.info=n.info;s.refreshButtonText=n.translateRefresh;u(function(){f.syncTree({tree:i.section,path:[-1,i.id],forceReload:!1});s.loading=!1})})},refresh:function(){r.all({refresh:o.refreshConnector(s.nodeId)}).then(function(){u(function(){f.syncTree({tree:i.section,path:[-1],forceReload:!0}).then(function(){t.reload()})})})}})}]);angular.module("umbraco.directives").directive("terrabecIframe",["$compile",function(n){return{restrict:"E",template:"<iframe><\/iframe>",scope:{iframeTemplate:"=",iframeContext:"="},link:function(t,i){var r=function(){angular.forEach(t.iframeContext,function(n,i){t[i]=n});f()},u=function(){n(i.find("iframe").contents().find("body").html(t.iframeTemplate).contents())(t)},f=function(){angular.forEach(t.iframeContext,function(n,i){t.$watch(function(n){return n.iframeContext[i]},function(){t[i]=t.iframeContext[i]})})};t.$watch("iframeTemplate",()=>{r(),u("template")})}}}]);angular.module("umbraco.directives").directive("terrabecDynamicHtml",["$compile",function(n){return{restrict:"E",scope:{contents:"="},link:function(t,i){let r=i;t.$watch("contents",function(){let i=n(t.contents)(t);r.replaceWith(i);r=i})}}}]);angular.module("umbraco").controller("terrabec.email",["$scope","$routeParams","$location","$q","$timeout","navigationService","terrabecService",function(n,t,i,r,u,f,e){var o=this;angular.extend(o,{loading:!0,nodeId:t.id,emails:[],email:null,overview:null,info:null,emailAddress:null,path:[],iframe:{},htmlDecode:function(n){var t=(new DOMParser).parseFromString(n,"text/html");return t.documentElement.textContent},init:function(n){r.all({overview:e.connector(o.nodeId),emails:n?e.enumerateEmailTemplates(o.nodeId):e.readEmailTemplate(o.nodeId)}).then(function(i){o.overview=i.overview;o.path=[-1,o.overview.nodeId];n?o.emails=i.emails:(o.path.push(o.overview.emailTemplatesNodeId),o.email=i.emails,o.iframe=JSON.parse('"'+o.email.content+'"'));o.path.push(t.id);u(function(){f.syncTree({tree:t.section,path:o.path,forceReload:!1});o.loading=!1})})},selectEmailTemplate:function(n){i.path("/"+t.section+"/"+t.section+"/emailtemplate/"+n)}})}]);angular.module("umbraco").controller("terrabec.list",["$scope","$route","$routeParams","$location","$q","$timeout","notificationsService","treeService","navigationService","terrabecService",function(n,t,i,r,u,f,e,o,s,h){var c=this;angular.extend(c,{loading:0,edit:1,saving:2,saved:3,error:4,state:0,nodeId:i.id,lists:[],list:null,overview:null,info:null,subscriptions:[],listName:null,path:[],init:function(n){u.all({overview:h.connector(c.nodeId),lists:n?h.enumerateLists(c.nodeId):h.readList(c.nodeId)}).then(function(t){c.overview=t.overview;c.path=[-1,c.overview.nodeId];n?c.lists=t.lists:(c.list=t.lists,c.path.push(c.overview.listsNodeId));c.path.push(i.id);u.all({subscriptions:h.readSubscriptions(c.nodeId)}).then(function(n){c.subscriptions=n.subscriptions;f(function(){s.syncTree({tree:i.section,path:c.path,forceReload:!1});c.state=c.edit})})})},selectList:function(n){r.path("/"+i.section+"/"+i.section+"/list/"+n)},createList:function(n){c.state=c.saving;u.all({list:h.createList(c.nodeId,n)}).then(function(n){c.list=n.list;c.state=c.saved},function(){c.state=c.error})},close:function(){s.hideDialog();f(function(){s.reloadNode(n.currentNode.parent());t.reload()})}})}]);angular.module("umbraco").controller("terrabec.overview",["$scope","$route","$routeParams","$location","$q","$timeout","navigationService","terrabecService",function(n,t,i,r,u,f,e,o){var s=this;angular.extend(s,{loading:!0,refreshing:!0,connectors:null,subscriptions:null,init:function(){u.all({connectors:o.connectors(),subscriptions:o.readSubscriptions()}).then(function(n){s.connectors=n.connectors;s.subscriptions=n.subscriptions;f(function(){e.syncTree({tree:i.section,path:[-1],forceReload:!1});s.loading=!1})})},selectInfo:function(n){r.path("/"+i.section+"/"+i.section+"/Connector/"+n)},refresh:function(){u.all({refresh:o.refresh()}).then(function(){f(function(){e.syncTree({tree:i.section,path:[-1],forceReload:!0}).then(function(){t.reload()})})})},close:function(){e.hideDialog()}})}]);angular.module("umbraco").controller("terrabec.queue",["$scope","$route","$routeParams","$q","$timeout","navigationService","localizationService","terrabecService",function(n,t,i,r,u,f,e,o){var s=this;angular.extend(s,{data:{},loading:!0,nodeId:i.id,overview:null,info:null,refreshButtonText:"",init:function(){r.all({overview:o.queue(s.nodeId),info:o.queueInfo(s.nodeId),translateRefresh:e.localize("TerrabecInfo_RefreshButton")}).then(function(n){s.overview=n.overview;s.info=n.info;s.refreshButtonText=n.translateRefresh;u(function(){f.syncTree({tree:i.section,path:[-1,i.id],forceReload:!1});s.loading=!1})})},refresh:function(){r.all({refresh:o.refreshQueue(s.nodeId)}).then(function(){u(function(){f.syncTree({tree:i.section,path:[-1],forceReload:!0}).then(function(){t.reload()})})})}})}]);angular.module("umbraco.resources").factory("terrabecService",["$http","$q",function(n,t){function r(i){var r=t.defer();return n.get(i).then(function(n){return r.resolve(n.data)},function(n){return r.reject(n)}),r.promise}var i="/umbraco/backoffice/terrabec/TerrabecApi/";return{refreshConnector:function(n){return r(i+"refreshConnector?nodeId="+n)},refreshQueue:function(n){return r(i+"refreshQueue?nodeId="+n)},connectors:function(){return r(i+"connectors")},connector:function(n){return r(i+"connector?nodeId="+n)},connectorInfo:function(n){return r(i+"connectorInfo?nodeId="+n)},enumerateLists:function(n){return r(i+"connectorEnumerateLists?nodeId="+n)},readList:function(n){return r(i+"ConnectorReadList?nodeId="+n)},createList:function(n,t){return r(i+"ConnectorCreateList?nodeId="+n+"&name="+t)},queues:function(){return r(i+"queues")},queue:function(n){return r(i+"queue?nodeId="+n)},queueInfo:function(n){return r(i+"queueInfo?nodeId="+n)},enumerateEmailTemplates:function(n){return r(i+"ConnectorEnumerateEmailTemplates?nodeId="+n)},readEmailTemplate:function(n){return r(i+"ConnectorReadEmailTemplate?nodeId="+n)},readSubscriptions:function(n){return typeof n=="undefined"&&(n=-1),r(i+"SubscriptionEnumerateSubscriptions?nodeId="+n)},sendEmail:function(n,t){return r(i+"SendEmail?nodeId="+n+"&email="+t)}}}]);